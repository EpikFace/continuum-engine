import { IncrementalEngine } from './engine.js';

const engine = new IncrementalEngine();

/**
 * This method is called for each 'tick' or cycle generated by requestAnimationFrame
 * @param {} dt 
 */
const onTick = (dt) => {
    engine.onTick(dt);
    updateUI();
    window.requestAnimationFrame(onTick);
}

// DOM elements
const statusDiv = document.getElementById("content");
let buttons = {}

function formatNumber(str) {
    if (typeof str != "string") return "Not a string";

    let intVal = str.split(".")[0];
    if (typeof intVal == "string") {
        
    }
    return str;
}

function updateUI() {
    let text = "Entities:<br><br>";

    for (let e in engine.entities) {
        let entity = engine.entities[e];
        text += `${e} (${entity.incrementBy}/${entity.incrementAfter}ms): ${formatNumber(entity.count.toFixed(2))}<br>`;
    }

    statusDiv.innerHTML = text;
}

// start the timer using animation frame
window.onload = function() {
    engine.createEntity("Source code", 20, 0, 1);
    engine.createEntity("Graphics", 75, 0, 1);
    engine.createEntity("Sound", 150, 0, 1);
    engine.createEntity("Text", 250, 0, 1);
    engine.createEntity("Translations", 650, 0, 0.1);

    buttons = {
        "Source Code": {
            "+": document.getElementById("SC+"),
            "-": document.getElementById("SC-")
        },
        "Graphics": {
            "+": document.getElementById("Graphics+"),
            "-": document.getElementById("Graphics-")
        }
    };

    buttons["Source Code"]["+"].addEventListener("click", (e) => {
        engine.entities["Source code"].incrementBy+=10000000000;
    });
    buttons["Source Code"]["-"].addEventListener("click", (e) => {
        engine.entities["Source code"].incrementBy--;
        if ( engine.entities["Source code"].incrementBy < 0 ) {
            engine.entities["Source code"].incrementBy = 0;
        }
    });
    buttons["Graphics"]["+"].addEventListener("click", (e) => {
        engine.entities["Graphics"].incrementBy++;
    });
    buttons["Graphics"]["-"].addEventListener("click", (e) => {
        engine.entities["Graphics"].incrementBy--;
        if ( engine.entities["Graphics"].incrementBy < 0 ) {
            engine.entities["Graphics"].incrementBy = 0;
        }
    });

    console.log("%cIncremental Engine loaded and initialised", "color: blue");
    window.requestAnimationFrame(onTick);
};
